{"metadata":{"title":"Flat Files","role":"article","modules":[{"name":"Massive"}],"roleHeading":"Article"},"schemaVersion":{"patch":0,"minor":3,"major":0},"variants":[{"paths":["\/documentation\/massive\/flatfiles"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"text":"Download bulk historical market data via S3-compatible storage.","type":"text"}],"seeAlsoSections":[{"title":"Essentials","identifiers":["doc:\/\/Massive\/documentation\/Massive\/GettingStarted","doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics"],"generated":true,"anchor":"Essentials"}],"identifier":{"url":"doc:\/\/Massive\/documentation\/Massive\/FlatFiles","interfaceLanguage":"swift"},"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/Massive\/documentation\/Massive"]]},"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","type":"heading","level":2,"anchor":"Overview"},{"type":"paragraph","inlineContent":[{"text":"Massive Flat Files provide compressed CSV files containing historical market data. This is more efficient than making individual REST API requests when you need large datasets.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"Data is organized by:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Asset Class","type":"text"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","isActive":true,"type":"reference"},{"type":"text","text":", "},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex"},{"text":", ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Data Type","type":"text"}]},{"text":": ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades"},{"text":", ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes"},{"text":", ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates"},{"text":", ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Date","type":"text"}]},{"text":": Files are organized by year and month","type":"text"}],"type":"paragraph"}]}]},{"type":"heading","level":2,"text":"Prerequisites","anchor":"Prerequisites"},{"type":"paragraph","inlineContent":[{"text":"You need S3 credentials (separate from your API key). Get them from the ","type":"text"},{"identifier":"https:\/\/massive.com\/dashboard","isActive":true,"type":"reference"},{"text":".","type":"text"}]},{"type":"heading","level":2,"text":"Creating an S3 Client","anchor":"Creating-an-S3-Client"},{"type":"codeListing","syntax":"swift","code":["import Massive","","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","","let s3 = S3Client.massiveFlatFiles(credentials: credentials)"]},{"type":"heading","level":2,"text":"Quick Start","anchor":"Quick-Start"},{"type":"paragraph","inlineContent":[{"text":"Hereâ€™s a complete example that downloads daily stock data and finds the top gainers:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Create S3 client with your credentials","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","let s3 = S3Client.massiveFlatFiles(credentials: credentials)","","\/\/ Download and parse minute bars for a specific date","let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","for bar in bars.prefix(10) {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close)\")","}","","\/\/ Download and parse trades","let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","print(\"Total trades: \\(trades.count)\")","","\/\/ List available files","let files = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","for file in files.objects {","    print(file.key)","}"]},{"type":"heading","level":2,"text":"Downloading and Parsing Data","anchor":"Downloading-and-Parsing-Data"},{"type":"paragraph","inlineContent":[{"text":"The simplest way to get market data is with the typed API, which downloads, decompresses, and parses in one step:","type":"text"}]},{"type":"heading","level":3,"text":"Minute Aggregates","anchor":"Minute-Aggregates"},{"type":"codeListing","syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","for bar in bars {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close) V=\\(bar.volume)\")","}"]},{"type":"heading","level":3,"text":"Day Aggregates","anchor":"Day-Aggregates"},{"type":"codeListing","syntax":"swift","code":["let dailyBars = try await s3.dayAggregates(for: .usStocks, date: \"2025-01-15\")"]},{"type":"heading","level":3,"text":"Trades","anchor":"Trades"},{"type":"codeListing","syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","for trade in trades {","    print(\"\\(trade.ticker) @ \\(trade.price) x \\(trade.size)\")","}"]},{"type":"heading","level":3,"text":"Quotes","anchor":"Quotes"},{"type":"codeListing","syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","for quote in quotes {","    print(\"\\(quote.ticker): \\(quote.bidPrice) \/ \\(quote.askPrice)\")","}"]},{"type":"heading","level":2,"text":"Working with Data Models","anchor":"Working-with-Data-Models"},{"type":"heading","level":3,"text":"Filtering by Ticker","anchor":"Filtering-by-Ticker"},{"type":"codeListing","syntax":"swift","code":["let allBars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","\/\/ Get all Apple bars","let aaplBars = allBars.filter { $0.ticker == \"AAPL\" }","","\/\/ Calculate VWAP (Volume Weighted Average Price)","let totalValue = aaplBars.reduce(0.0) { $0 + $1.close * Double($1.volume) }","let totalVolume = aaplBars.reduce(0) { $0 + $1.volume }","let vwap = totalValue \/ Double(totalVolume)"]},{"type":"heading","level":3,"text":"Using Timestamps","anchor":"Using-Timestamps"},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart","isActive":true,"type":"reference"},{"text":" property is a ","type":"text"},{"code":"Timestamp","type":"codeVoice"},{"text":" with nanosecond precision:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["for bar in aaplBars {","    \/\/ Get the timestamp as a formatted string","    print(\"\\(bar.windowStart): \\(bar.close)\")","    ","    \/\/ Access raw nanoseconds since epoch","    let nanos = bar.windowStart.nanosecondsSinceEpoch","    ","    \/\/ Arithmetic with Duration","    let fiveMinutesLater = bar.windowStart + .seconds(300)","}"]},{"type":"heading","level":3,"text":"Analyzing Trades","anchor":"Analyzing-Trades"},{"type":"codeListing","syntax":"swift","code":["let allTrades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","\/\/ Filter for large block trades (10,000+ shares)","let blockTrades = allTrades.filter { $0.size >= 10_000 }","","\/\/ Group by ticker","let tradesByTicker = Dictionary(grouping: blockTrades) { $0.ticker }","","for (ticker, tickerTrades) in tradesByTicker.prefix(5) {","    let totalVolume = tickerTrades.reduce(0) { $0 + $1.size }","    print(\"\\(ticker): \\(tickerTrades.count) block trades, \\(totalVolume) shares\")","}"]},{"type":"heading","level":3,"text":"Working with Quotes","anchor":"Working-with-Quotes"},{"type":"codeListing","syntax":"swift","code":["let allQuotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","\/\/ Calculate bid-ask spreads","let aaplQuotes = allQuotes.filter { $0.ticker == \"AAPL\" }","let avgSpread = aaplQuotes.reduce(0.0) { $0 + ($1.askPrice - $1.bidPrice) } \/ Double(aaplQuotes.count)","print(\"AAPL average spread: $\\(String(format: \"%.4f\", avgSpread))\")"]},{"type":"heading","level":2,"text":"Listing Files","anchor":"Listing-Files"},{"type":"heading","level":3,"text":"List by Asset Class and Data Type","anchor":"List-by-Asset-Class-and-Data-Type"},{"type":"codeListing","syntax":"swift","code":["let result = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","","for file in result.objects {","    print(\"\\(file.key) - \\(file.size) bytes\")","}"]},{"type":"heading","level":3,"text":"List with Custom Prefix","anchor":"List-with-Custom-Prefix"},{"type":"codeListing","syntax":"swift","code":["let prefixResult = try await s3.list(prefix: \"us_stocks_sip\/trades_v1\/2025\/\")"]},{"type":"heading","level":3,"text":"Handle Pagination","anchor":"Handle-Pagination"},{"type":"paragraph","inlineContent":[{"text":"For directories with many files:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["for try await page in s3.listAll(prefix: \"us_stocks_sip\/\") {","    for file in page.objects {","        print(file.key)","    }","}"]},{"type":"heading","level":2,"text":"Downloading Raw Files","anchor":"Downloading-Raw-Files"},{"type":"paragraph","inlineContent":[{"text":"If you need the raw gzip-compressed CSV data:","type":"text"}]},{"type":"heading","level":3,"text":"Download to Memory","anchor":"Download-to-Memory"},{"type":"codeListing","syntax":"swift","code":["let data = try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\"",")","\/\/ data is gzip-compressed CSV"]},{"type":"heading","level":3,"text":"Download to Disk","anchor":"Download-to-Disk"},{"type":"paragraph","inlineContent":[{"text":"For larger files, stream directly to disk to avoid memory pressure:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let destination = URL(filePath: \"\/path\/to\/file.csv.gz\")","","try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\",","    to: destination",")"]},{"type":"heading","level":3,"text":"Download by Key","anchor":"Download-by-Key"},{"type":"paragraph","inlineContent":[{"text":"If you know the exact file path:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let keyData = try await s3.download(","    key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\"",")"]},{"type":"heading","level":2,"text":"Checking File Existence","anchor":"Checking-File-Existence"},{"type":"paragraph","inlineContent":[{"text":"Use ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)","isActive":true,"type":"reference"},{"text":" to check if a file exists without downloading:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["if let metadata = try await s3.head(key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\") {","    print(\"Size: \\(metadata.size) bytes\")","    print(\"ETag: \\(metadata.etag ?? \"unknown\")\")","} else {","    print(\"File not found\")","}"]},{"type":"heading","level":2,"text":"Available Data","anchor":"Available-Data"},{"type":"heading","level":3,"text":"Asset Classes","anchor":"Asset-Classes"},{"type":"table","header":"row","rows":[[[{"inlineContent":[{"text":"Asset Class","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Description","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"us_stocks_sip","type":"codeVoice"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Stocks (SIP consolidated feed)"}]}]],[[{"inlineContent":[{"code":"us_options_opra","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"text":"US Options (OPRA feed)","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"indices","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Market indices"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"forex","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Foreign exchange","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"crypto","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Cryptocurrencies"}],"type":"paragraph"}]]]},{"type":"heading","level":3,"text":"Data Types","anchor":"Data-Types"},{"type":"table","header":"row","rows":[[[{"inlineContent":[{"text":"Data Type","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Description","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"trades_v1"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Individual trades","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"quotes_v1"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Bid\/ask quotes","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"minute_aggs_v1"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Minute OHLCV bars","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"day_aggs_v1"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Daily OHLCV bars"}],"type":"paragraph"}]]]},{"anchor":"File-Format","type":"heading","text":"File Format","level":2},{"inlineContent":[{"type":"text","text":"Files are gzip-compressed CSV with a header row. Example minute aggregate:"}],"type":"paragraph"},{"code":["ticker,volume,open,close,high,low,window_start,transactions","AAPL,4930,200.29,200.5,200.63,200.29,1744792500000000000,129"],"syntax":"csv","type":"codeListing"},{"inlineContent":[{"type":"text","text":"Data for each trading day is typically available by 11:00 AM ET the following day."}],"type":"paragraph"},{"anchor":"Error-Handling","type":"heading","text":"Error Handling","level":2},{"code":["do {","    let errorData = try await s3.download(key: \"nonexistent.csv.gz\")","} catch let error as S3Error {","    switch error {","    case .notFound(let key):","        print(\"File not found: \\(key)\")","    case .httpError(let statusCode, let message):","        print(\"HTTP \\(statusCode): \\(message ?? \"unknown\")\")","    case .invalidResponse:","        print(\"Invalid response\")","    case .xmlParseError(let details):","        print(\"XML parse error: \\(details)\")","    }","}"],"syntax":"swift","type":"codeListing"}]}],"references":{"doc://Massive/documentation/Massive/AssetClass/crypto":{"url":"\/documentation\/massive\/assetclass\/crypto","role":"symbol","title":"AssetClass.crypto","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","type":"topic","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"crypto","kind":"identifier"}],"abstract":[{"text":"Cryptocurrency markets.","type":"text"}]},"doc://Massive/documentation/Massive/DataType/minuteAggregates":{"kind":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"minuteAggregates"}],"type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","abstract":[{"text":"One-minute OHLCV candlesticks.","type":"text"}],"role":"symbol","url":"\/documentation\/massive\/datatype\/minuteaggregates","title":"DataType.minuteAggregates"},"doc://Massive/documentation/Massive/AssetClass/forex":{"url":"\/documentation\/massive\/assetclass\/forex","role":"symbol","title":"AssetClass.forex","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","type":"topic","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"forex"}],"abstract":[{"text":"Foreign exchange (currency pairs).","type":"text"}]},"doc://Massive/documentation/Massive/DataType/trades":{"url":"\/documentation\/massive\/datatype\/trades","role":"symbol","title":"DataType.trades","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","type":"topic","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"trades","kind":"identifier"}],"abstract":[{"type":"text","text":"Individual trade executions with nanosecond timestamps."}]},"doc://Massive/documentation/Massive/MinuteAggregate/windowStart":{"kind":"symbol","fragments":[{"text":"let","kind":"keyword"},{"text":" ","kind":"text"},{"text":"windowStart","kind":"identifier"},{"text":": ","kind":"text"},{"text":"Timestamp","preciseIdentifier":"s:5Fetch9TimestampV","kind":"typeIdentifier"}],"type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart","abstract":[{"text":"The start of the minute window as a precise timestamp.","type":"text"}],"role":"symbol","url":"\/documentation\/massive\/minuteaggregate\/windowstart","title":"windowStart"},"doc://Massive/documentation/Massive/AssetClass/indices":{"url":"\/documentation\/massive\/assetclass\/indices","role":"symbol","title":"AssetClass.indices","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","type":"topic","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"indices","kind":"identifier"}],"abstract":[{"text":"Market indices (e.g., S&P 500, Dow Jones).","type":"text"}]},"doc://Massive/documentation/Massive/AdvancedTopics":{"kind":"article","type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics","abstract":[{"text":"Access fundamentals, corporate actions, economic indicators, and market snapshots.","type":"text"}],"role":"article","url":"\/documentation\/massive\/advancedtopics","title":"Advanced Topics"},"doc://Massive/documentation/Massive/S3Client/head(key:)":{"abstract":[{"text":"Checks if an object exists and returns its metadata.","type":"text"}],"title":"head(key:)","identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)","url":"\/documentation\/massive\/s3client\/head(key:)","kind":"symbol","role":"symbol","type":"topic","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"head","kind":"identifier"},{"text":"(","kind":"text"},{"text":"key","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"S3ObjectMetadata","preciseIdentifier":"s:7Massive16S3ObjectMetadataV","kind":"typeIdentifier"},{"kind":"text","text":"?"}]},"doc://Massive/documentation/Massive":{"type":"topic","abstract":[{"text":"A Swift client for the Massive API providing access to financial market data.","type":"text"}],"role":"collection","url":"\/documentation\/massive","kind":"symbol","title":"Massive","identifier":"doc:\/\/Massive\/documentation\/Massive"},"doc://Massive/documentation/Massive/AssetClass/usStocks":{"abstract":[{"text":"US Stocks from the Securities Information Processor (SIP).","type":"text"}],"url":"\/documentation\/massive\/assetclass\/usstocks","title":"AssetClass.usStocks","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","kind":"symbol","role":"symbol","type":"topic","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"usStocks"}]},"https://massive.com/dashboard":{"identifier":"https:\/\/massive.com\/dashboard","url":"https:\/\/massive.com\/dashboard","type":"link","title":"Massive Dashboard","titleInlineContent":[{"type":"text","text":"Massive Dashboard"}]},"doc://Massive/documentation/Massive/AssetClass/usOptions":{"url":"\/documentation\/massive\/assetclass\/usoptions","role":"symbol","title":"AssetClass.usOptions","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","type":"topic","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"usOptions","kind":"identifier"}],"abstract":[{"text":"US Options from the Options Price Reporting Authority (OPRA).","type":"text"}]},"doc://Massive/documentation/Massive/GettingStarted":{"title":"Getting Started","type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/GettingStarted","kind":"article","abstract":[{"text":"Set up the Massive client and make your first API requests.","type":"text"}],"role":"article","url":"\/documentation\/massive\/gettingstarted"},"doc://Massive/documentation/Massive/DataType/quotes":{"url":"\/documentation\/massive\/datatype\/quotes","role":"symbol","title":"DataType.quotes","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","type":"topic","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"quotes"}],"abstract":[{"type":"text","text":"Top-of-book quotes with nanosecond timestamps."}]},"doc://Massive/documentation/Massive/DataType/dayAggregates":{"abstract":[{"text":"Daily OHLCV candlesticks.","type":"text"}],"title":"DataType.dayAggregates","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","url":"\/documentation\/massive\/datatype\/dayaggregates","kind":"symbol","role":"symbol","type":"topic","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"dayAggregates"}]}}}