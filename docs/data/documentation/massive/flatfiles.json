{"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/massive\/flatfiles"]}],"seeAlsoSections":[{"title":"Essentials","generated":true,"anchor":"Essentials","identifiers":["doc:\/\/Massive\/documentation\/Massive\/GettingStarted","doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics"]}],"hierarchy":{"paths":[["doc:\/\/Massive\/documentation\/Massive"]]},"abstract":[{"type":"text","text":"Download bulk historical market data via S3-compatible storage."}],"schemaVersion":{"minor":3,"major":0,"patch":0},"sections":[],"metadata":{"roleHeading":"Article","title":"Flat Files","modules":[{"name":"Massive"}],"role":"article"},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Massive\/documentation\/Massive\/FlatFiles"},"kind":"article","primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","type":"heading","text":"Overview","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Massive Flat Files provide compressed CSV files containing historical market data. This is more efficient than making individual REST API requests when you need large datasets."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Data is organized by:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Asset Class","type":"text"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","isActive":true,"type":"reference"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Data Type","type":"text"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","isActive":true,"type":"reference"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"Date","type":"text"}],"type":"strong"},{"text":": Files are organized by year and month","type":"text"}]}]}]},{"anchor":"Prerequisites","type":"heading","text":"Prerequisites","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"You need S3 credentials (separate from your API key). Get them from the "},{"type":"reference","isActive":true,"identifier":"https:\/\/massive.com\/dashboard"},{"type":"text","text":"."}]},{"anchor":"Creating-an-S3-Client","type":"heading","text":"Creating an S3 Client","level":2},{"type":"codeListing","syntax":"swift","code":["import Massive","","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","","let s3 = S3Client.massiveFlatFiles(credentials: credentials)"]},{"anchor":"Quick-Start","type":"heading","text":"Quick Start","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Hereâ€™s a complete example that downloads daily stock data and finds the top gainers:"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Create S3 client with your credentials","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","let s3 = S3Client.massiveFlatFiles(credentials: credentials)","","\/\/ Download and parse minute bars for a specific date","let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","for bar in bars.prefix(10) {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close)\")","}","","\/\/ Download and parse trades","let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","print(\"Total trades: \\(trades.count)\")","","\/\/ List available files","let files = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","for file in files.objects {","    print(file.key)","}"]},{"anchor":"Downloading-and-Parsing-Data","type":"heading","text":"Downloading and Parsing Data","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"The simplest way to get market data is with the typed API, which downloads, decompresses, and parses in one step:"}]},{"anchor":"Minute-Aggregates","type":"heading","text":"Minute Aggregates","level":3},{"type":"codeListing","syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","for bar in bars {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close) V=\\(bar.volume)\")","}"]},{"anchor":"Day-Aggregates","type":"heading","text":"Day Aggregates","level":3},{"type":"codeListing","syntax":"swift","code":["let dailyBars = try await s3.dayAggregates(for: .usStocks, date: \"2025-01-15\")"]},{"anchor":"Trades","type":"heading","text":"Trades","level":3},{"type":"codeListing","syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","for trade in trades {","    print(\"\\(trade.ticker) @ \\(trade.price) x \\(trade.size)\")","}"]},{"anchor":"Quotes","type":"heading","text":"Quotes","level":3},{"type":"codeListing","syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","for quote in quotes {","    print(\"\\(quote.ticker): \\(quote.bidPrice) \/ \\(quote.askPrice)\")","}"]},{"anchor":"Working-with-Data-Models","type":"heading","text":"Working with Data Models","level":2},{"anchor":"Filtering-by-Ticker","type":"heading","text":"Filtering by Ticker","level":3},{"type":"codeListing","syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","\/\/ Get all Apple bars","let aaplBars = bars.filter { $0.ticker == \"AAPL\" }","","\/\/ Calculate VWAP (Volume Weighted Average Price)","let totalValue = aaplBars.reduce(0.0) { $0 + $1.close * Double($1.volume) }","let totalVolume = aaplBars.reduce(0) { $0 + $1.volume }","let vwap = totalValue \/ Double(totalVolume)"]},{"anchor":"Using-Timestamps","type":"heading","text":"Using Timestamps","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart"},{"type":"text","text":" property is a "},{"type":"codeVoice","code":"Timestamp"},{"type":"text","text":" with nanosecond precision:"}]},{"type":"codeListing","syntax":"swift","code":["for bar in aaplBars {","    \/\/ Get the timestamp as a formatted string","    print(\"\\(bar.windowStart): \\(bar.close)\")","    ","    \/\/ Access raw nanoseconds since epoch","    let nanos = bar.windowStart.nanosecondsSinceEpoch","    ","    \/\/ Arithmetic with Duration","    let fiveMinutesLater = bar.windowStart + .seconds(300)","}"]},{"anchor":"Analyzing-Trades","type":"heading","text":"Analyzing Trades","level":3},{"type":"codeListing","syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","\/\/ Filter for large block trades (10,000+ shares)","let blockTrades = trades.filter { $0.size >= 10_000 }","","\/\/ Group by ticker","let tradesByTicker = Dictionary(grouping: blockTrades) { $0.ticker }","","for (ticker, tickerTrades) in tradesByTicker.prefix(5) {","    let totalVolume = tickerTrades.reduce(0) { $0 + $1.size }","    print(\"\\(ticker): \\(tickerTrades.count) block trades, \\(totalVolume) shares\")","}"]},{"anchor":"Working-with-Quotes","type":"heading","text":"Working with Quotes","level":3},{"type":"codeListing","syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","\/\/ Calculate bid-ask spreads","let aaplQuotes = quotes.filter { $0.ticker == \"AAPL\" }","let avgSpread = aaplQuotes.reduce(0.0) { $0 + ($1.askPrice - $1.bidPrice) } \/ Double(aaplQuotes.count)","print(\"AAPL average spread: $\\(String(format: \"%.4f\", avgSpread))\")"]},{"anchor":"Listing-Files","type":"heading","text":"Listing Files","level":2},{"anchor":"List-by-Asset-Class-and-Data-Type","type":"heading","text":"List by Asset Class and Data Type","level":3},{"type":"codeListing","syntax":"swift","code":["let result = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","","for file in result.objects {","    print(\"\\(file.key) - \\(file.size) bytes\")","}"]},{"anchor":"List-with-Custom-Prefix","type":"heading","text":"List with Custom Prefix","level":3},{"type":"codeListing","syntax":"swift","code":["let result = try await s3.list(prefix: \"us_stocks_sip\/trades_v1\/2025\/\")"]},{"anchor":"Handle-Pagination","type":"heading","text":"Handle Pagination","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"For directories with many files:"}]},{"type":"codeListing","syntax":"swift","code":["for try await page in s3.listAll(prefix: \"us_stocks_sip\/\") {","    for file in page.objects {","        print(file.key)","    }","}"]},{"anchor":"Downloading-Raw-Files","type":"heading","text":"Downloading Raw Files","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you need the raw gzip-compressed CSV data:"}]},{"anchor":"Download-to-Memory","type":"heading","text":"Download to Memory","level":3},{"type":"codeListing","syntax":"swift","code":["let data = try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\"",")","\/\/ data is gzip-compressed CSV"]},{"anchor":"Download-to-Disk","type":"heading","text":"Download to Disk","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"For larger files, stream directly to disk to avoid memory pressure:"}]},{"type":"codeListing","syntax":"swift","code":["let destination = URL(filePath: \"\/path\/to\/file.csv.gz\")","","try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\",","    to: destination",")"]},{"anchor":"Download-by-Key","type":"heading","text":"Download by Key","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you know the exact file path:"}]},{"type":"codeListing","syntax":"swift","code":["let data = try await s3.download(","    key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\"",")"]},{"anchor":"Checking-File-Existence","type":"heading","text":"Checking File Existence","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Use "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)"},{"type":"text","text":" to check if a file exists without downloading:"}]},{"type":"codeListing","syntax":"swift","code":["if let metadata = try await s3.head(key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\") {","    print(\"Size: \\(metadata.size) bytes\")","    print(\"ETag: \\(metadata.etag ?? \"unknown\")\")","} else {","    print(\"File not found\")","}"]},{"anchor":"Available-Data","type":"heading","text":"Available Data","level":2},{"anchor":"Asset-Classes","type":"heading","text":"Asset Classes","level":3},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Asset Class"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Description"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"us_stocks_sip"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Stocks (SIP consolidated feed)"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"us_options_opra"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Options (OPRA feed)"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"indices"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Market indices"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"forex"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Foreign exchange"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"crypto"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Cryptocurrencies"}]}]]]},{"anchor":"Data-Types","type":"heading","text":"Data Types","level":3},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Data Type"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Description"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"trades_v1"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Individual trades"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"quotes_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Bid\/ask quotes","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"minute_aggs_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Minute OHLCV bars","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"day_aggs_v1","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"text":"Daily OHLCV bars","type":"text"}]}]]]},{"text":"File Format","level":2,"type":"heading","anchor":"File-Format"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Files are gzip-compressed CSV with a header row. Example minute aggregate:"}]},{"type":"codeListing","syntax":"csv","code":["ticker,volume,open,close,high,low,window_start,transactions","AAPL,4930,200.29,200.5,200.63,200.29,1744792500000000000,129"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Data for each trading day is typically available by 11:00 AM ET the following day."}]},{"type":"heading","level":2,"anchor":"Error-Handling","text":"Error Handling"},{"type":"codeListing","syntax":"swift","code":["do {","    let data = try await s3.download(key: \"nonexistent.csv.gz\")","} catch let error as S3Error {","    switch error {","    case .notFound(let key):","        print(\"File not found: \\(key)\")","    case .httpError(let statusCode, let message):","        print(\"HTTP \\(statusCode): \\(message ?? \"unknown\")\")","    case .invalidResponse:","        print(\"Invalid response\")","    case .xmlParseError(let details):","        print(\"XML parse error: \\(details)\")","    }","}"]}]}],"references":{"doc://Massive/documentation/Massive/DataType/trades":{"fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"trades"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","kind":"symbol","url":"\/documentation\/massive\/datatype\/trades","title":"DataType.trades","abstract":[{"type":"text","text":"Individual trade executions with nanosecond timestamps."}],"type":"topic","role":"symbol"},"doc://Massive/documentation/Massive/AssetClass/usOptions":{"type":"topic","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"usOptions","kind":"identifier"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","abstract":[{"type":"text","text":"US Options from the Options Price Reporting Authority (OPRA)."}],"role":"symbol","kind":"symbol","url":"\/documentation\/massive\/assetclass\/usoptions","title":"AssetClass.usOptions"},"doc://Massive/documentation/Massive/AdvancedTopics":{"url":"\/documentation\/massive\/advancedtopics","abstract":[{"type":"text","text":"Access fundamentals, corporate actions, economic indicators, and market snapshots."}],"type":"topic","title":"Advanced Topics","identifier":"doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics","role":"article","kind":"article"},"https://massive.com/dashboard":{"title":"Massive Dashboard","type":"link","url":"https:\/\/massive.com\/dashboard","titleInlineContent":[{"type":"text","text":"Massive Dashboard"}],"identifier":"https:\/\/massive.com\/dashboard"},"doc://Massive/documentation/Massive/DataType/dayAggregates":{"fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"dayAggregates"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","kind":"symbol","url":"\/documentation\/massive\/datatype\/dayaggregates","title":"DataType.dayAggregates","abstract":[{"type":"text","text":"Daily OHLCV candlesticks."}],"type":"topic","role":"symbol"},"doc://Massive/documentation/Massive/DataType/quotes":{"fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"quotes"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","kind":"symbol","url":"\/documentation\/massive\/datatype\/quotes","title":"DataType.quotes","abstract":[{"type":"text","text":"Top-of-book quotes with nanosecond timestamps."}],"type":"topic","role":"symbol"},"doc://Massive/documentation/Massive":{"abstract":[{"text":"A Swift client for the Massive API providing access to financial market data.","type":"text"}],"kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive","title":"Massive","role":"collection","url":"\/documentation\/massive","type":"topic"},"doc://Massive/documentation/Massive/AssetClass/forex":{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","url":"\/documentation\/massive\/assetclass\/forex","type":"topic","kind":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"forex","kind":"identifier"}],"title":"AssetClass.forex","role":"symbol","abstract":[{"text":"Foreign exchange (currency pairs).","type":"text"}]},"doc://Massive/documentation/Massive/AssetClass/indices":{"role":"symbol","title":"AssetClass.indices","url":"\/documentation\/massive\/assetclass\/indices","abstract":[{"type":"text","text":"Market indices (e.g., S&P 500, Dow Jones)."}],"fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"indices","kind":"identifier"}],"kind":"symbol","type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices"},"doc://Massive/documentation/Massive/AssetClass/usStocks":{"role":"symbol","title":"AssetClass.usStocks","url":"\/documentation\/massive\/assetclass\/usstocks","abstract":[{"text":"US Stocks from the Securities Information Processor (SIP).","type":"text"}],"fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"usStocks","kind":"identifier"}],"kind":"symbol","type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks"},"doc://Massive/documentation/Massive/GettingStarted":{"type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/GettingStarted","abstract":[{"type":"text","text":"Set up the Massive client and make your first API requests."}],"role":"article","kind":"article","url":"\/documentation\/massive\/gettingstarted","title":"Getting Started"},"doc://Massive/documentation/Massive/AssetClass/crypto":{"url":"\/documentation\/massive\/assetclass\/crypto","kind":"symbol","title":"AssetClass.crypto","abstract":[{"text":"Cryptocurrency markets.","type":"text"}],"fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"crypto","kind":"identifier"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","role":"symbol","type":"topic"},"doc://Massive/documentation/Massive/S3Client/head(key:)":{"type":"topic","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"kind":"identifier","text":"head"},{"kind":"text","text":"("},{"kind":"externalParam","text":"key"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":") "},{"kind":"keyword","text":"async"},{"kind":"text","text":" "},{"kind":"keyword","text":"throws"},{"kind":"text","text":" -> "},{"kind":"typeIdentifier","preciseIdentifier":"s:7Massive16S3ObjectMetadataV","text":"S3ObjectMetadata"},{"kind":"text","text":"?"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)","abstract":[{"type":"text","text":"Checks if an object exists and returns its metadata."}],"role":"symbol","kind":"symbol","url":"\/documentation\/massive\/s3client\/head(key:)","title":"head(key:)"},"doc://Massive/documentation/Massive/DataType/minuteAggregates":{"fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"minuteAggregates"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","kind":"symbol","url":"\/documentation\/massive\/datatype\/minuteaggregates","title":"DataType.minuteAggregates","abstract":[{"type":"text","text":"One-minute OHLCV candlesticks."}],"type":"topic","role":"symbol"},"doc://Massive/documentation/Massive/MinuteAggregate/windowStart":{"fragments":[{"kind":"keyword","text":"let"},{"kind":"text","text":" "},{"kind":"identifier","text":"windowStart"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:5Fetch9TimestampV","text":"Timestamp"}],"url":"\/documentation\/massive\/minuteaggregate\/windowstart","type":"topic","title":"windowStart","abstract":[{"text":"The start of the minute window as a precise timestamp.","type":"text"}],"role":"symbol","kind":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart"}}}