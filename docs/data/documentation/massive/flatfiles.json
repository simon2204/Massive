{"identifier":{"url":"doc:\/\/Massive\/documentation\/Massive\/FlatFiles","interfaceLanguage":"swift"},"metadata":{"role":"article","modules":[{"name":"Massive"}],"roleHeading":"Article","title":"Flat Files"},"sections":[],"seeAlsoSections":[{"generated":true,"title":"Essentials","anchor":"Essentials","identifiers":["doc:\/\/Massive\/documentation\/Massive\/GettingStarted","doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics"]}],"primaryContentSections":[{"kind":"content","content":[{"type":"heading","text":"Overview","level":2,"anchor":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Massive Flat Files provide compressed CSV files containing historical market data. This is more efficient than making individual REST API requests when you need large datasets."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Data is organized by:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"inlineContent":[{"text":"Asset Class","type":"text"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","isActive":true,"type":"reference"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"Data Type","type":"text"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","isActive":true,"type":"reference"},{"text":", ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","isActive":true,"type":"reference"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Date"}],"type":"strong"},{"type":"text","text":": Files are organized by year and month"}],"type":"paragraph"}]}]},{"type":"heading","text":"Prerequisites","level":2,"anchor":"Prerequisites"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You need S3 credentials (separate from your API key). Get them from the "},{"type":"reference","isActive":true,"identifier":"https:\/\/massive.com\/dashboard"},{"type":"text","text":"."}]},{"type":"heading","text":"Creating an S3 Client","level":2,"anchor":"Creating-an-S3-Client"},{"type":"codeListing","syntax":"swift","code":["import Massive","","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","","let s3 = S3Client.massiveFlatFiles(credentials: credentials)"]},{"anchor":"Quick-Start","type":"heading","text":"Quick Start","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Hereâ€™s a complete example that downloads daily stock data and finds the top gainers:"}]},{"syntax":"swift","code":["\/\/ Create S3 client with your credentials","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","let s3 = S3Client.massiveFlatFiles(credentials: credentials)","","\/\/ Download and parse minute bars for a specific date","let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","for bar in bars.prefix(10) {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close)\")","}","","\/\/ Download and parse trades","let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","print(\"Total trades: \\(trades.count)\")","","\/\/ List available files","let files = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","for file in files.objects {","    print(file.key)","}"],"type":"codeListing"},{"anchor":"Downloading-and-Parsing-Data","type":"heading","level":2,"text":"Downloading and Parsing Data"},{"type":"paragraph","inlineContent":[{"text":"The simplest way to get market data is with the typed API, which downloads, decompresses, and parses in one step:","type":"text"}]},{"type":"heading","text":"Minute Aggregates","level":3,"anchor":"Minute-Aggregates"},{"type":"codeListing","syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","for bar in bars {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close) V=\\(bar.volume)\")","}"]},{"type":"heading","text":"Day Aggregates","level":3,"anchor":"Day-Aggregates"},{"type":"codeListing","syntax":"swift","code":["let dailyBars = try await s3.dayAggregates(for: .usStocks, date: \"2025-01-15\")"]},{"type":"heading","text":"Trades","level":3,"anchor":"Trades"},{"syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","for trade in trades {","    print(\"\\(trade.ticker) @ \\(trade.price) x \\(trade.size)\")","}"],"type":"codeListing"},{"anchor":"Quotes","type":"heading","level":3,"text":"Quotes"},{"syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","for quote in quotes {","    print(\"\\(quote.ticker): \\(quote.bidPrice) \/ \\(quote.askPrice)\")","}"],"type":"codeListing"},{"type":"heading","text":"Working with Data Models","level":2,"anchor":"Working-with-Data-Models"},{"type":"heading","text":"Filtering by Ticker","level":3,"anchor":"Filtering-by-Ticker"},{"syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","\/\/ Get all Apple bars","let aaplBars = bars.filter { $0.ticker == \"AAPL\" }","","\/\/ Calculate VWAP (Volume Weighted Average Price)","let totalValue = aaplBars.reduce(0.0) { $0 + $1.close * Double($1.volume) }","let totalVolume = aaplBars.reduce(0) { $0 + $1.volume }","let vwap = totalValue \/ Double(totalVolume)"],"type":"codeListing"},{"anchor":"Using-Timestamps","type":"heading","level":3,"text":"Using Timestamps"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart"},{"type":"text","text":" property is a "},{"type":"codeVoice","code":"Timestamp"},{"type":"text","text":" with nanosecond precision:"}]},{"syntax":"swift","code":["for bar in aaplBars {","    \/\/ Get the timestamp as a formatted string","    print(\"\\(bar.windowStart): \\(bar.close)\")","    ","    \/\/ Access raw nanoseconds since epoch","    let nanos = bar.windowStart.nanosecondsSinceEpoch","    ","    \/\/ Arithmetic with Duration","    let fiveMinutesLater = bar.windowStart + .seconds(300)","}"],"type":"codeListing"},{"anchor":"Analyzing-Trades","type":"heading","level":3,"text":"Analyzing Trades"},{"syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","\/\/ Filter for large block trades (10,000+ shares)","let blockTrades = trades.filter { $0.size >= 10_000 }","","\/\/ Group by ticker","let tradesByTicker = Dictionary(grouping: blockTrades) { $0.ticker }","","for (ticker, tickerTrades) in tradesByTicker.prefix(5) {","    let totalVolume = tickerTrades.reduce(0) { $0 + $1.size }","    print(\"\\(ticker): \\(tickerTrades.count) block trades, \\(totalVolume) shares\")","}"],"type":"codeListing"},{"anchor":"Working-with-Quotes","type":"heading","level":3,"text":"Working with Quotes"},{"syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","\/\/ Calculate bid-ask spreads","let aaplQuotes = quotes.filter { $0.ticker == \"AAPL\" }","let avgSpread = aaplQuotes.reduce(0.0) { $0 + ($1.askPrice - $1.bidPrice) } \/ Double(aaplQuotes.count)","print(\"AAPL average spread: $\\(String(format: \"%.4f\", avgSpread))\")"],"type":"codeListing"},{"anchor":"Listing-Files","type":"heading","level":2,"text":"Listing Files"},{"anchor":"List-by-Asset-Class-and-Data-Type","type":"heading","level":3,"text":"List by Asset Class and Data Type"},{"syntax":"swift","code":["let result = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","","for file in result.objects {","    print(\"\\(file.key) - \\(file.size) bytes\")","}"],"type":"codeListing"},{"anchor":"List-with-Custom-Prefix","type":"heading","level":3,"text":"List with Custom Prefix"},{"syntax":"swift","code":["let result = try await s3.list(prefix: \"us_stocks_sip\/trades_v1\/2025\/\")"],"type":"codeListing"},{"anchor":"Handle-Pagination","type":"heading","level":3,"text":"Handle Pagination"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For directories with many files:"}]},{"syntax":"swift","code":["for try await page in s3.listAll(prefix: \"us_stocks_sip\/\") {","    for file in page.objects {","        print(file.key)","    }","}"],"type":"codeListing"},{"anchor":"Downloading-Raw-Files","type":"heading","level":2,"text":"Downloading Raw Files"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you need the raw gzip-compressed CSV data:"}]},{"anchor":"Download-to-Memory","type":"heading","level":3,"text":"Download to Memory"},{"syntax":"swift","code":["let data = try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\"",")","\/\/ data is gzip-compressed CSV"],"type":"codeListing"},{"type":"heading","text":"Download to Disk","level":3,"anchor":"Download-to-Disk"},{"inlineContent":[{"type":"text","text":"For larger files, stream directly to disk to avoid memory pressure:"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let destination = URL(filePath: \"\/path\/to\/file.csv.gz\")","","try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\",","    to: destination",")"]},{"anchor":"Download-by-Key","text":"Download by Key","level":3,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"If you know the exact file path:","type":"text"}]},{"syntax":"swift","code":["let data = try await s3.download(","    key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\"",")"],"type":"codeListing"},{"anchor":"Checking-File-Existence","type":"heading","level":2,"text":"Checking File Existence"},{"type":"paragraph","inlineContent":[{"text":"Use ","type":"text"},{"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)","isActive":true,"type":"reference"},{"text":" to check if a file exists without downloading:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["if let metadata = try await s3.head(key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\") {","    print(\"Size: \\(metadata.size) bytes\")","    print(\"ETag: \\(metadata.etag ?? \"unknown\")\")","} else {","    print(\"File not found\")","}"]},{"type":"heading","text":"Available Data","level":2,"anchor":"Available-Data"},{"level":3,"text":"Asset Classes","anchor":"Asset-Classes","type":"heading"},{"rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Asset Class"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Description"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"us_stocks_sip"}]}],[{"inlineContent":[{"type":"text","text":"US Stocks (SIP consolidated feed)"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"us_options_opra"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Options (OPRA feed)"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"indices"}]}],[{"type":"paragraph","inlineContent":[{"text":"Market indices","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"forex"}]}],[{"type":"paragraph","inlineContent":[{"text":"Foreign exchange","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"crypto"}]}],[{"type":"paragraph","inlineContent":[{"text":"Cryptocurrencies","type":"text"}]}]]],"header":"row","type":"table"},{"text":"Data Types","anchor":"Data-Types","type":"heading","level":3},{"rows":[[[{"type":"paragraph","inlineContent":[{"text":"Data Type","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"Description","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"trades_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Individual trades","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"quotes_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Bid\/ask quotes","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"minute_aggs_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Minute OHLCV bars","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"day_aggs_v1"}]}],[{"type":"paragraph","inlineContent":[{"text":"Daily OHLCV bars","type":"text"}]}]]],"header":"row","type":"table"},{"text":"File Format","anchor":"File-Format","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"Files are gzip-compressed CSV with a header row. Example minute aggregate:"}],"type":"paragraph"},{"code":["ticker,volume,open,close,high,low,window_start,transactions","AAPL,4930,200.29,200.5,200.63,200.29,1744792500000000000,129"],"syntax":"csv","type":"codeListing"},{"inlineContent":[{"text":"Data for each trading day is typically available by 11:00 AM ET the following day.","type":"text"}],"type":"paragraph"},{"type":"heading","anchor":"Error-Handling","level":2,"text":"Error Handling"},{"type":"codeListing","syntax":"swift","code":["do {","    let data = try await s3.download(key: \"nonexistent.csv.gz\")","} catch let error as S3Error {","    switch error {","    case .notFound(let key):","        print(\"File not found: \\(key)\")","    case .httpError(let statusCode, let message):","        print(\"HTTP \\(statusCode): \\(message ?? \"unknown\")\")","    case .invalidResponse:","        print(\"Invalid response\")","    case .xmlParseError(let details):","        print(\"XML parse error: \\(details)\")","    }","}"]}]}],"kind":"article","abstract":[{"type":"text","text":"Download bulk historical market data via S3-compatible storage."}],"variants":[{"paths":["\/documentation\/massive\/flatfiles"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"major":0,"patch":0,"minor":3},"hierarchy":{"paths":[["doc:\/\/Massive\/documentation\/Massive"]]},"references":{"doc://Massive/documentation/Massive/DataType/dayAggregates":{"abstract":[{"type":"text","text":"Daily OHLCV candlesticks."}],"title":"DataType.dayAggregates","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"dayAggregates","kind":"identifier"}],"kind":"symbol","type":"topic","role":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","url":"\/documentation\/massive\/datatype\/dayaggregates"},"doc://Massive/documentation/Massive/AssetClass/crypto":{"abstract":[{"type":"text","text":"Cryptocurrency markets."}],"title":"AssetClass.crypto","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"crypto","kind":"identifier"}],"kind":"symbol","type":"topic","role":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","url":"\/documentation\/massive\/assetclass\/crypto"},"doc://Massive/documentation/Massive/AdvancedTopics":{"role":"article","title":"Advanced Topics","type":"topic","abstract":[{"type":"text","text":"Access fundamentals, corporate actions, economic indicators, and market snapshots."}],"url":"\/documentation\/massive\/advancedtopics","identifier":"doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics","kind":"article"},"doc://Massive/documentation/Massive/AssetClass/indices":{"abstract":[{"type":"text","text":"Market indices (e.g., S&P 500, Dow Jones)."}],"title":"AssetClass.indices","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"indices","kind":"identifier"}],"kind":"symbol","type":"topic","role":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","url":"\/documentation\/massive\/assetclass\/indices"},"doc://Massive/documentation/Massive/S3Client/head(key:)":{"fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"head","kind":"identifier"},{"text":"(","kind":"text"},{"text":"key","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"String","kind":"typeIdentifier","preciseIdentifier":"s:SS"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"S3ObjectMetadata","kind":"typeIdentifier","preciseIdentifier":"s:7Massive16S3ObjectMetadataV"},{"text":"?","kind":"text"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)","type":"topic","url":"\/documentation\/massive\/s3client\/head(key:)","abstract":[{"text":"Checks if an object exists and returns its metadata.","type":"text"}],"kind":"symbol","title":"head(key:)","role":"symbol"},"doc://Massive/documentation/Massive/DataType/trades":{"abstract":[{"text":"Individual trade executions with nanosecond timestamps.","type":"text"}],"title":"DataType.trades","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"trades","kind":"identifier"}],"kind":"symbol","type":"topic","role":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","url":"\/documentation\/massive\/datatype\/trades"},"doc://Massive/documentation/Massive/AssetClass/usStocks":{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","kind":"symbol","type":"topic","title":"AssetClass.usStocks","url":"\/documentation\/massive\/assetclass\/usstocks","abstract":[{"text":"US Stocks from the Securities Information Processor (SIP).","type":"text"}],"role":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"usStocks"}]},"doc://Massive/documentation/Massive/DataType/minuteAggregates":{"abstract":[{"text":"One-minute OHLCV candlesticks.","type":"text"}],"title":"DataType.minuteAggregates","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"minuteAggregates"}],"kind":"symbol","type":"topic","role":"symbol","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","url":"\/documentation\/massive\/datatype\/minuteaggregates"},"doc://Massive/documentation/Massive/DataType/quotes":{"fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"quotes","kind":"identifier"}],"role":"symbol","title":"DataType.quotes","type":"topic","abstract":[{"type":"text","text":"Top-of-book quotes with nanosecond timestamps."}],"url":"\/documentation\/massive\/datatype\/quotes","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","kind":"symbol"},"https://massive.com/dashboard":{"title":"Massive Dashboard","titleInlineContent":[{"type":"text","text":"Massive Dashboard"}],"type":"link","identifier":"https:\/\/massive.com\/dashboard","url":"https:\/\/massive.com\/dashboard"},"doc://Massive/documentation/Massive":{"role":"collection","type":"topic","url":"\/documentation\/massive","title":"Massive","identifier":"doc:\/\/Massive\/documentation\/Massive","kind":"symbol","abstract":[{"type":"text","text":"A Swift client for the Massive API providing access to financial market data."}]},"doc://Massive/documentation/Massive/AssetClass/usOptions":{"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","kind":"symbol","type":"topic","title":"AssetClass.usOptions","url":"\/documentation\/massive\/assetclass\/usoptions","abstract":[{"text":"US Options from the Options Price Reporting Authority (OPRA).","type":"text"}],"role":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"usOptions"}]},"doc://Massive/documentation/Massive/MinuteAggregate/windowStart":{"fragments":[{"text":"let","kind":"keyword"},{"text":" ","kind":"text"},{"text":"windowStart","kind":"identifier"},{"text":": ","kind":"text"},{"text":"Timestamp","kind":"typeIdentifier","preciseIdentifier":"s:5Fetch9TimestampV"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart","type":"topic","url":"\/documentation\/massive\/minuteaggregate\/windowstart","abstract":[{"text":"The start of the minute window as a precise timestamp.","type":"text"}],"title":"windowStart","kind":"symbol","role":"symbol"},"doc://Massive/documentation/Massive/GettingStarted":{"identifier":"doc:\/\/Massive\/documentation\/Massive\/GettingStarted","abstract":[{"type":"text","text":"Set up the Massive client and make your first API requests."}],"kind":"article","title":"Getting Started","url":"\/documentation\/massive\/gettingstarted","type":"topic","role":"article"},"doc://Massive/documentation/Massive/AssetClass/forex":{"abstract":[{"text":"Foreign exchange (currency pairs).","type":"text"}],"role":"symbol","kind":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"forex","kind":"identifier"}],"type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","url":"\/documentation\/massive\/assetclass\/forex","title":"AssetClass.forex"}}}