{"seeAlsoSections":[{"generated":true,"anchor":"Essentials","title":"Essentials","identifiers":["doc:\/\/Massive\/documentation\/Massive\/GettingStarted","doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics"]}],"hierarchy":{"paths":[["doc:\/\/Massive\/documentation\/Massive"]]},"metadata":{"roleHeading":"Article","role":"article","title":"Flat Files","modules":[{"name":"Massive"}]},"primaryContentSections":[{"content":[{"text":"Overview","type":"heading","level":2,"anchor":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Massive Flat Files provide compressed CSV files containing historical market data. This is more efficient than making individual REST API requests when you need large datasets."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Data is organized by:"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Asset Class"}],"type":"strong"},{"type":"text","text":": "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","isActive":true},{"text":", ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex"},{"text":", ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Data Type","type":"text"}]},{"type":"text","text":": "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates","isActive":true},{"type":"text","text":", "},{"type":"reference","identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates","isActive":true}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Date"}]},{"type":"text","text":": Files are organized by year and month"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"Prerequisites","type":"heading","level":2,"anchor":"Prerequisites"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You need S3 credentials (separate from your API key). Get them from the "},{"type":"reference","identifier":"https:\/\/massive.com\/dashboard","isActive":true},{"type":"text","text":"."}]},{"text":"Creating an S3 Client","type":"heading","level":2,"anchor":"Creating-an-S3-Client"},{"syntax":"swift","code":["import Massive","","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","","let s3 = S3Client.massiveFlatFiles(credentials: credentials)"],"type":"codeListing"},{"level":2,"anchor":"Quick-Start","text":"Quick Start","type":"heading"},{"inlineContent":[{"text":"Hereâ€™s a complete example that downloads daily stock data and finds the top gainers:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["\/\/ Create S3 client with your credentials","let credentials = S3Credentials(","    accessKeyId: \"your-access-key\",","    secretAccessKey: \"your-secret-key\"",")","let s3 = S3Client.massiveFlatFiles(credentials: credentials)","","\/\/ Download and parse minute bars for a specific date","let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","for bar in bars.prefix(10) {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close)\")","}","","\/\/ Download and parse trades","let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","print(\"Total trades: \\(trades.count)\")","","\/\/ List available files","let files = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","for file in files.objects {","    print(file.key)","}"],"type":"codeListing"},{"level":2,"anchor":"Downloading-and-Parsing-Data","text":"Downloading and Parsing Data","type":"heading"},{"inlineContent":[{"text":"The simplest way to get market data is with the typed API, which downloads, decompresses, and parses in one step:","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Minute-Aggregates","text":"Minute Aggregates","type":"heading"},{"syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","for bar in bars {","    print(\"\\(bar.ticker): O=\\(bar.open) H=\\(bar.high) L=\\(bar.low) C=\\(bar.close) V=\\(bar.volume)\")","}"],"type":"codeListing"},{"level":3,"anchor":"Day-Aggregates","text":"Day Aggregates","type":"heading"},{"syntax":"swift","code":["let dailyBars = try await s3.dayAggregates(for: .usStocks, date: \"2025-01-15\")"],"type":"codeListing"},{"level":3,"anchor":"Trades","text":"Trades","type":"heading"},{"syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","for trade in trades {","    print(\"\\(trade.ticker) @ \\(trade.price) x \\(trade.size)\")","}"],"type":"codeListing"},{"level":3,"anchor":"Quotes","text":"Quotes","type":"heading"},{"syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","for quote in quotes {","    print(\"\\(quote.ticker): \\(quote.bidPrice) \/ \\(quote.askPrice)\")","}"],"type":"codeListing"},{"level":2,"anchor":"Working-with-Data-Models","text":"Working with Data Models","type":"heading"},{"level":3,"anchor":"Filtering-by-Ticker","text":"Filtering by Ticker","type":"heading"},{"syntax":"swift","code":["let bars = try await s3.minuteAggregates(for: .usStocks, date: \"2025-01-15\")","","\/\/ Get all Apple bars","let aaplBars = bars.filter { $0.ticker == \"AAPL\" }","","\/\/ Calculate VWAP (Volume Weighted Average Price)","let totalValue = aaplBars.reduce(0.0) { $0 + $1.close * Double($1.volume) }","let totalVolume = aaplBars.reduce(0) { $0 + $1.volume }","let vwap = totalValue \/ Double(totalVolume)"],"type":"codeListing"},{"level":3,"anchor":"Using-Timestamps","text":"Using Timestamps","type":"heading"},{"inlineContent":[{"text":"The ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart"},{"text":" property is a ","type":"text"},{"type":"codeVoice","code":"Timestamp"},{"text":" with nanosecond precision:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["for bar in aaplBars {","    \/\/ Get the timestamp as a formatted string","    print(\"\\(bar.windowStart): \\(bar.close)\")","    ","    \/\/ Access raw nanoseconds since epoch","    let nanos = bar.windowStart.nanosecondsSinceEpoch","    ","    \/\/ Arithmetic with Duration","    let fiveMinutesLater = bar.windowStart + .seconds(300)","}"],"type":"codeListing"},{"level":3,"anchor":"Analyzing-Trades","text":"Analyzing Trades","type":"heading"},{"syntax":"swift","code":["let trades = try await s3.trades(for: .usStocks, date: \"2025-01-15\")","","\/\/ Filter for large block trades (10,000+ shares)","let blockTrades = trades.filter { $0.size >= 10_000 }","","\/\/ Group by ticker","let tradesByTicker = Dictionary(grouping: blockTrades) { $0.ticker }","","for (ticker, tickerTrades) in tradesByTicker.prefix(5) {","    let totalVolume = tickerTrades.reduce(0) { $0 + $1.size }","    print(\"\\(ticker): \\(tickerTrades.count) block trades, \\(totalVolume) shares\")","}"],"type":"codeListing"},{"level":3,"anchor":"Working-with-Quotes","text":"Working with Quotes","type":"heading"},{"syntax":"swift","code":["let quotes = try await s3.quotes(for: .usStocks, date: \"2025-01-15\")","","\/\/ Calculate bid-ask spreads","let aaplQuotes = quotes.filter { $0.ticker == \"AAPL\" }","let avgSpread = aaplQuotes.reduce(0.0) { $0 + ($1.askPrice - $1.bidPrice) } \/ Double(aaplQuotes.count)","print(\"AAPL average spread: $\\(String(format: \"%.4f\", avgSpread))\")"],"type":"codeListing"},{"level":2,"anchor":"Listing-Files","text":"Listing Files","type":"heading"},{"level":3,"anchor":"List-by-Asset-Class-and-Data-Type","text":"List by Asset Class and Data Type","type":"heading"},{"syntax":"swift","code":["let result = try await s3.listFlatFiles(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    year: 2025,","    month: 1",")","","for file in result.objects {","    print(\"\\(file.key) - \\(file.size) bytes\")","}"],"type":"codeListing"},{"level":3,"anchor":"List-with-Custom-Prefix","text":"List with Custom Prefix","type":"heading"},{"syntax":"swift","code":["let result = try await s3.list(prefix: \"us_stocks_sip\/trades_v1\/2025\/\")"],"type":"codeListing"},{"level":3,"anchor":"Handle-Pagination","text":"Handle Pagination","type":"heading"},{"inlineContent":[{"text":"For directories with many files:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["for try await page in s3.listAll(prefix: \"us_stocks_sip\/\") {","    for file in page.objects {","        print(file.key)","    }","}"],"type":"codeListing"},{"level":2,"anchor":"Downloading-Raw-Files","text":"Downloading Raw Files","type":"heading"},{"inlineContent":[{"text":"If you need the raw gzip-compressed CSV data:","type":"text"}],"type":"paragraph"},{"level":3,"anchor":"Download-to-Memory","text":"Download to Memory","type":"heading"},{"syntax":"swift","code":["let data = try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\"",")","\/\/ data is gzip-compressed CSV"],"type":"codeListing"},{"level":3,"anchor":"Download-to-Disk","text":"Download to Disk","type":"heading"},{"inlineContent":[{"text":"For larger files, stream directly to disk to avoid memory pressure:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["let destination = URL(filePath: \"\/path\/to\/file.csv.gz\")","","try await s3.downloadFlatFile(","    assetClass: .usStocks,","    dataType: .minuteAggregates,","    date: \"2025-01-02\",","    to: destination",")"],"type":"codeListing"},{"level":3,"anchor":"Download-by-Key","text":"Download by Key","type":"heading"},{"inlineContent":[{"text":"If you know the exact file path:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["let data = try await s3.download(","    key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\"",")"],"type":"codeListing"},{"level":2,"anchor":"Checking-File-Existence","text":"Checking File Existence","type":"heading"},{"inlineContent":[{"text":"Use ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)"},{"text":" to check if a file exists without downloading:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["if let metadata = try await s3.head(key: \"us_stocks_sip\/minute_aggs_v1\/2025\/01\/2025-01-02.csv.gz\") {","    print(\"Size: \\(metadata.size) bytes\")","    print(\"ETag: \\(metadata.etag ?? \"unknown\")\")","} else {","    print(\"File not found\")","}"],"type":"codeListing"},{"level":2,"anchor":"Available-Data","text":"Available Data","type":"heading"},{"level":3,"anchor":"Asset-Classes","text":"Asset Classes","type":"heading"},{"header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Asset Class"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Description"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"us_stocks_sip"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Stocks (SIP consolidated feed)"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"us_options_opra"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"US Options (OPRA feed)"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"indices"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Market indices"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"forex"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Foreign exchange"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"crypto"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Cryptocurrencies"}]}]]],"type":"table"},{"level":3,"anchor":"Data-Types","text":"Data Types","type":"heading"},{"header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Data Type"}]}],[{"inlineContent":[{"type":"text","text":"Description"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"trades_v1"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Individual trades"}]}]],[[{"inlineContent":[{"code":"quotes_v1","type":"codeVoice"}],"type":"paragraph"}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Bid\/ask quotes"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"minute_aggs_v1"}]}],[{"inlineContent":[{"type":"text","text":"Minute OHLCV bars"}],"type":"paragraph"}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"day_aggs_v1"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Daily OHLCV bars"}]}]]],"type":"table"},{"level":2,"anchor":"File-Format","text":"File Format","type":"heading"},{"inlineContent":[{"type":"text","text":"Files are gzip-compressed CSV with a header row. Example minute aggregate:"}],"type":"paragraph"},{"syntax":"csv","code":["ticker,volume,open,close,high,low,window_start,transactions","AAPL,4930,200.29,200.5,200.63,200.29,1744792500000000000,129"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"Data for each trading day is typically available by 11:00 AM ET the following day."}],"type":"paragraph"},{"type":"heading","text":"Error Handling","anchor":"Error-Handling","level":2},{"syntax":"swift","type":"codeListing","code":["do {","    let data = try await s3.download(key: \"nonexistent.csv.gz\")","} catch let error as S3Error {","    switch error {","    case .notFound(let key):","        print(\"File not found: \\(key)\")","    case .httpError(let statusCode, let message):","        print(\"HTTP \\(statusCode): \\(message ?? \"unknown\")\")","    case .invalidResponse:","        print(\"Invalid response\")","    case .xmlParseError(let details):","        print(\"XML parse error: \\(details)\")","    }","}"]}],"kind":"content"}],"schemaVersion":{"major":0,"minor":3,"patch":0},"kind":"article","sections":[],"identifier":{"url":"doc:\/\/Massive\/documentation\/Massive\/FlatFiles","interfaceLanguage":"swift"},"variants":[{"paths":["\/documentation\/massive\/flatfiles"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"text":"Download bulk historical market data via S3-compatible storage.","type":"text"}],"references":{"doc://Massive/documentation/Massive/DataType/trades":{"type":"topic","url":"\/documentation\/massive\/datatype\/trades","abstract":[{"text":"Individual trade executions with nanosecond timestamps.","type":"text"}],"role":"symbol","title":"DataType.trades","kind":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"trades"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/trades"},"doc://Massive/documentation/Massive/DataType/dayAggregates":{"type":"topic","url":"\/documentation\/massive\/datatype\/dayaggregates","abstract":[{"type":"text","text":"Daily OHLCV candlesticks."}],"role":"symbol","title":"DataType.dayAggregates","kind":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"dayAggregates"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/dayAggregates"},"doc://Massive/documentation/Massive/DataType/minuteAggregates":{"type":"topic","url":"\/documentation\/massive\/datatype\/minuteaggregates","abstract":[{"text":"One-minute OHLCV candlesticks.","type":"text"}],"role":"symbol","title":"DataType.minuteAggregates","kind":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"kind":"identifier","text":"minuteAggregates"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/minuteAggregates"},"doc://Massive/documentation/Massive/MinuteAggregate/windowStart":{"type":"topic","url":"\/documentation\/massive\/minuteaggregate\/windowstart","abstract":[{"text":"The start of the minute window as a precise timestamp.","type":"text"}],"role":"symbol","title":"windowStart","kind":"symbol","fragments":[{"kind":"keyword","text":"let"},{"kind":"text","text":" "},{"kind":"identifier","text":"windowStart"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Timestamp","preciseIdentifier":"s:5Fetch9TimestampV"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/MinuteAggregate\/windowStart"},"doc://Massive/documentation/Massive/AssetClass/indices":{"abstract":[{"text":"Market indices (e.g., S&P 500, Dow Jones).","type":"text"}],"role":"symbol","kind":"symbol","url":"\/documentation\/massive\/assetclass\/indices","fragments":[{"text":"case","kind":"keyword"},{"kind":"text","text":" "},{"text":"indices","kind":"identifier"}],"title":"AssetClass.indices","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/indices","type":"topic"},"doc://Massive/documentation/Massive/GettingStarted":{"type":"topic","url":"\/documentation\/massive\/gettingstarted","abstract":[{"text":"Set up the Massive client and make your first API requests.","type":"text"}],"role":"article","title":"Getting Started","kind":"article","identifier":"doc:\/\/Massive\/documentation\/Massive\/GettingStarted"},"doc://Massive/documentation/Massive/AssetClass/forex":{"kind":"symbol","url":"\/documentation\/massive\/assetclass\/forex","type":"topic","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/forex","role":"symbol","title":"AssetClass.forex","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"forex","kind":"identifier"}],"abstract":[{"type":"text","text":"Foreign exchange (currency pairs)."}]},"doc://Massive/documentation/Massive/AssetClass/crypto":{"abstract":[{"text":"Cryptocurrency markets.","type":"text"}],"role":"symbol","kind":"symbol","url":"\/documentation\/massive\/assetclass\/crypto","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"crypto","kind":"identifier"}],"title":"AssetClass.crypto","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/crypto","type":"topic"},"https://massive.com/dashboard":{"url":"https:\/\/massive.com\/dashboard","type":"link","title":"Massive Dashboard","titleInlineContent":[{"text":"Massive Dashboard","type":"text"}],"identifier":"https:\/\/massive.com\/dashboard"},"doc://Massive/documentation/Massive/DataType/quotes":{"type":"topic","url":"\/documentation\/massive\/datatype\/quotes","abstract":[{"type":"text","text":"Top-of-book quotes with nanosecond timestamps."}],"role":"symbol","title":"DataType.quotes","kind":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"quotes","kind":"identifier"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/DataType\/quotes"},"doc://Massive/documentation/Massive/AdvancedTopics":{"abstract":[{"text":"Access fundamentals, corporate actions, economic indicators, and market snapshots.","type":"text"}],"role":"article","kind":"article","url":"\/documentation\/massive\/advancedtopics","title":"Advanced Topics","identifier":"doc:\/\/Massive\/documentation\/Massive\/AdvancedTopics","type":"topic"},"doc://Massive/documentation/Massive":{"type":"topic","role":"collection","url":"\/documentation\/massive","identifier":"doc:\/\/Massive\/documentation\/Massive","title":"Massive","kind":"symbol","abstract":[{"type":"text","text":"A Swift client for the Massive API providing access to financial market data."}]},"doc://Massive/documentation/Massive/AssetClass/usStocks":{"abstract":[{"text":"US Stocks from the Securities Information Processor (SIP).","type":"text"}],"role":"symbol","kind":"symbol","url":"\/documentation\/massive\/assetclass\/usstocks","fragments":[{"kind":"keyword","text":"case"},{"text":" ","kind":"text"},{"kind":"identifier","text":"usStocks"}],"title":"AssetClass.usStocks","identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usStocks","type":"topic"},"doc://Massive/documentation/Massive/AssetClass/usOptions":{"type":"topic","url":"\/documentation\/massive\/assetclass\/usoptions","abstract":[{"type":"text","text":"US Options from the Options Price Reporting Authority (OPRA)."}],"role":"symbol","title":"AssetClass.usOptions","kind":"symbol","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"text":"usOptions","kind":"identifier"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/AssetClass\/usOptions"},"doc://Massive/documentation/Massive/S3Client/head(key:)":{"type":"topic","url":"\/documentation\/massive\/s3client\/head(key:)","abstract":[{"text":"Checks if an object exists and returns its metadata.","type":"text"}],"role":"symbol","title":"head(key:)","kind":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"head","kind":"identifier"},{"text":"(","kind":"text"},{"text":"key","kind":"externalParam"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:SS","text":"String","kind":"typeIdentifier"},{"text":") ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:7Massive16S3ObjectMetadataV","text":"S3ObjectMetadata","kind":"typeIdentifier"},{"text":"?","kind":"text"}],"identifier":"doc:\/\/Massive\/documentation\/Massive\/S3Client\/head(key:)"}}}